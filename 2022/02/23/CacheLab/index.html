<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="CacheLab前期准备 评分标准 相关ppt  安装valgrind内存泄露检测工具。1sudo apt install valgrind  相关参数1、         输入模式1234I 0400d7d4,8M 0421c7f0,4L 04f6b868,8S 7ff0005c8,8  The operation field denotes the type of memory access:">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/2022/02/23/CacheLab/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="CacheLab前期准备 评分标准 相关ppt  安装valgrind内存泄露检测工具。1sudo apt install valgrind  相关参数1、         输入模式1234I 0400d7d4,8M 0421c7f0,4L 04f6b868,8S 7ff0005c8,8  The operation field denotes the type of memory access:">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="c:/Users/DELL/AppData/Roaming/Typora/typora-user-images/image-20220227165149385.png">
<meta property="og:image" content="c:/Users/DELL/AppData/Roaming/Typora/typora-user-images/image-20220227165226934.png">
<meta property="article:published_time" content="2022-02-23T14:10:28.433Z">
<meta property="article:modified_time" content="2022-02-27T09:13:43.046Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="c:/Users/DELL/AppData/Roaming/Typora/typora-user-images/image-20220227165149385.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-CacheLab" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/02/23/CacheLab/" class="article-date">
  <time class="dt-published" datetime="2022-02-23T14:10:28.433Z" itemprop="datePublished">2022-02-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="CacheLab"><a href="#CacheLab" class="headerlink" title="CacheLab"></a>CacheLab</h1><h2 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h2><blockquote>
<p><a target="_blank" rel="noopener" href="http://www.cs.cmu.edu/afs/cs/academic/class/15213-f15/www/recitations/rec07.pdf">评分标准</a></p>
<p><a target="_blank" rel="noopener" href="http://www.cs.cmu.edu/afs/cs/academic/class/15213-f15/www/recitations/rec07.pdf">相关ppt</a></p>
</blockquote>
<h3 id="安装valgrind内存泄露检测工具。"><a href="#安装valgrind内存泄露检测工具。" class="headerlink" title="安装valgrind内存泄露检测工具。"></a>安装valgrind内存泄露检测工具。</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install valgrind</span><br></pre></td></tr></table></figure>

<h3 id="相关参数"><a href="#相关参数" class="headerlink" title="相关参数"></a>相关参数</h3><p>1、</p>
<img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20220227165149385.png" alt="图片" style="zoom:50%;" />



<img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20220227165226934.png" alt="结构层次" style="zoom:50%;" />



<h3 id="输入模式"><a href="#输入模式" class="headerlink" title="输入模式"></a>输入模式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">I 0400d7d4,8</span><br><span class="line">M 0421c7f0,4</span><br><span class="line">L 04f6b868,8</span><br><span class="line">S 7ff0005c8,8</span><br></pre></td></tr></table></figure>

<p>The operation field denotes the type of memory access: “I” denotes an instruction load, “L” a data load, “S” a data store, and “M” a data modify (i.e., a data load followed by a data store). There is never a space before each “I”. There is always a space before each “M”, “L”, and “S”. The address field specifies a 64-bit hexadecimal memory address. The size field specifies the number of bytes accessed by the operation.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Usage: ./csim-ref [-hv] -s &lt;s&gt; -E &lt;E&gt; -b &lt;b&gt; -t &lt;tracefile&gt;</span><br><span class="line">• -h: Optional help flag that prints usage info</span><br><span class="line">• -v: Optional verbose flag that displays trace info</span><br><span class="line">• -s &lt;s&gt;: Number of set index bits (S = 2^s is the number of sets)</span><br><span class="line">• -E &lt;E&gt;: Associativity (number of lines per set)</span><br><span class="line">• -b &lt;b&gt;: Number of block bits (B = 2^b is the block size)</span><br><span class="line">• -t &lt;tracefile&gt;: Name of the valgrind trace to replay</span><br></pre></td></tr></table></figure>

<p> 分析：</p>
<p>​        I 、M 、L 、S  为操作模式，I 为取指令，在本次lab里可以忽略；M 为修改，先取后存；L 为 load ；S 为store</p>
<p>​        地址为最重要的参数，需要根据输入的  <code>S</code>  <code>E</code> <code>B</code> 来确定，采取组相联的模式</p>
<p>​        地址分解函数如下：</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Split</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> *address_c,<span class="keyword">unsigned</span> <span class="keyword">long</span> address)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mask1=<span class="number">1</span>,mask2=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;s<span class="number">-1</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        mask1=mask1&lt;&lt;<span class="number">1</span>;</span><br><span class="line">        mask1=mask1|<span class="number">0x1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;s+b<span class="number">-1</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        mask2=mask2&lt;&lt;<span class="number">1</span>;</span><br><span class="line">        mask2=mask2|<span class="number">0x1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    address_c[<span class="number">0</span>]=<span class="number">0</span>; <span class="comment">//偏移量</span></span><br><span class="line">    address_c[<span class="number">1</span>]=(address&gt;&gt;b)&amp;(mask1); <span class="comment">//组号</span></span><br><span class="line">    address_c[<span class="number">2</span>]=((address&gt;&gt;(b+s)));   <span class="comment">//标志位</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="调试方法"><a href="#调试方法" class="headerlink" title="调试方法"></a>调试方法</h3><p> 1、标准测试</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./test-csim</span><br></pre></td></tr></table></figure>

<p>2、标准cache测试</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./csim-ref -v -s 2 -E 2 -b 3 -t traces/trans.trace</span><br></pre></td></tr></table></figure>

<p>3、自行测试</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./csim -v -s 2 -E 2 -b 3 -t traces/trans.trace</span><br></pre></td></tr></table></figure>



<h2 id="代码与注释"><a href="#代码与注释" class="headerlink" title="代码与注释"></a>代码与注释</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;cachelab.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;getopt.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span>  <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;string.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stdlib.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;math.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *usage =<span class="string">&quot;Usage: ./csim-ref [-hv] -s &lt;s&gt; -E &lt;E&gt; -b &lt;b&gt; -t &lt;tracefile&gt;\n&quot;</span>;</span><br><span class="line"><span class="keyword">int</span> v,h,s,E,b,t,S;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> mask1=<span class="number">1</span>,mask2=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> hits=<span class="number">0</span>,misss=<span class="number">0</span>,evictions=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">char</span> file[<span class="number">1000</span>];</span><br><span class="line"><span class="comment">//cache 采用二维动态数组建立</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Cache</span>    </span></span><br><span class="line"><span class="class">&#123;</span> </span><br><span class="line">    <span class="keyword">int</span> vaild; <span class="comment">//有效位 （未使用）</span></span><br><span class="line">    <span class="keyword">int</span> tag;   <span class="comment">//标志位</span></span><br><span class="line">    <span class="keyword">int</span> LRU_flag; <span class="comment">//LRU 标志位</span></span><br><span class="line">&#125;cache_block,*cache_set,**cache;  </span><br><span class="line"><span class="comment">//命中後，hits++，  更新LRU_flag</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">HIt</span><span class="params">(struct Cache *cache_set,<span class="keyword">int</span> hit_num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    hits++;</span><br><span class="line">    <span class="keyword">if</span>(v==<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot; hit&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;E;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        cache_set[i].LRU_flag++;    <span class="comment">//采用位数法：命中或使用过的清0，未使用过的+1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cache_set[hit_num].LRU_flag=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果有空格，直接填入</span></span><br><span class="line"><span class="comment">//沒有則置換</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span>  <span class="title">Eviction</span><span class="params">(struct  Cache *<span class="built_in">set</span>,<span class="keyword">int</span> tag)</span>  <span class="comment">//置换</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    evictions++;</span><br><span class="line">    <span class="keyword">if</span>(v==<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot; eviction&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> max=<span class="number">0</span>,index=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;E;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">set</span>[i].LRU_flag&gt;max)   <span class="comment">//置换最大的数</span></span><br><span class="line">        &#123;</span><br><span class="line">            max=<span class="built_in">set</span>[i].LRU_flag; </span><br><span class="line">            index=i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">set</span>[i].LRU_flag++;      <span class="comment">//最开始将这句话遗忘了，置换以后也要将其他的+1；</span></span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">set</span>[index].LRU_flag=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">set</span>[index].tag=tag;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Miss</span><span class="params">(struct Cache *<span class="built_in">set</span>,<span class="keyword">int</span> tag)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    misss++;</span><br><span class="line">    <span class="keyword">if</span>(v==<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot; miss&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;E;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">set</span>[i].vaild==<span class="number">0</span>)    <span class="comment">//如果还有空闲块</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">set</span>[i].vaild=<span class="number">1</span>;</span><br><span class="line">            <span class="built_in">set</span>[i].tag=tag;</span><br><span class="line">            <span class="built_in">set</span>[i].LRU_flag=<span class="number">0</span>; <span class="comment">///未完成</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    Eviction(<span class="built_in">set</span>,tag);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//寻找cache里面是否有对应的块</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Search</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">long</span> address,<span class="keyword">unsigned</span> <span class="keyword">int</span> *address_c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">set</span>,flag;</span><br><span class="line">    <span class="built_in">set</span>=address_c[<span class="number">1</span>];</span><br><span class="line">    flag=address_c[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;E;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(cache[<span class="built_in">set</span>][i].tag==flag)</span><br><span class="line">        &#123;</span><br><span class="line">            HIt(cache[<span class="built_in">set</span>],i);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Miss(cache[<span class="built_in">set</span>],address_c[<span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//分解地址函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Split</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> *address_c,<span class="keyword">unsigned</span> <span class="keyword">long</span> address)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    address_c[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    address_c[<span class="number">1</span>]=(address&gt;&gt;b)&amp;(mask1);</span><br><span class="line">    address_c[<span class="number">2</span>]=((address&gt;&gt;(b+s)));</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_Cache</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> E,<span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cache=<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(cache_set)*S);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span> ; i &lt; S ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        cache[i]=<span class="built_in">malloc</span>(<span class="keyword">sizeof</span> (cache_block)*E);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;E;j++)</span><br><span class="line">        &#123;</span><br><span class="line">            cache[i][j].tag=<span class="number">-1</span>;</span><br><span class="line">            cache[i][j].LRU_flag=<span class="number">0</span>;</span><br><span class="line">            cache[i][j].vaild=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//读取文件</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">trace_test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    FILE *pFile;</span><br><span class="line">    pFile = fopen(file,<span class="string">&quot;r&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(pFile==<span class="literal">NULL</span>)</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">char</span> identifier;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> address;</span><br><span class="line">    <span class="keyword">int</span> size;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> address_c[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">fscanf</span>(pFile,<span class="string">&quot; %c %lx,%d&quot;</span>,&amp;identifier,&amp;address,&amp;size)&gt;<span class="number">0</span>)   <span class="comment">//在读文件的时候，fscanf要判断条件要&gt;0,否则没有结束</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//<span class="doctag">TODO:</span></span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (identifier) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;I&#x27;</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;L&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span>(v==<span class="number">1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;%c %lx %d,&quot;</span>,identifier,address,size);</span><br><span class="line">                &#125;</span><br><span class="line">                Split(address_c,address);</span><br><span class="line">                Search(address,address_c);</span><br><span class="line">                <span class="keyword">if</span>(v==<span class="number">1</span>)</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;S&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span>(v==<span class="number">1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;%c %lx %d,&quot;</span>,identifier,address,size);</span><br><span class="line">                &#125;</span><br><span class="line">                Split(address_c,address);</span><br><span class="line">                Search(address,address_c);</span><br><span class="line">                <span class="keyword">if</span>(v==<span class="number">1</span>)</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;M&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span>(v==<span class="number">1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;%c %lx %d,&quot;</span>,identifier,address,size);</span><br><span class="line">                &#125;</span><br><span class="line">                Split(address_c,address);</span><br><span class="line">                Search(address,address_c);</span><br><span class="line">                Search(address,address_c);</span><br><span class="line">                <span class="keyword">if</span>(v==<span class="number">1</span>)</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    fclose(pFile);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc ,<span class="keyword">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> opt;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">-1</span>!=(opt = getopt(argc, argv,<span class="string">&quot;vhs:E:b:t:&quot;</span>)))  <span class="comment">//分解操作符</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">switch</span>(opt)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;h&#x27;</span>:</span><br><span class="line">                <span class="built_in">puts</span>(usage);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">case</span><span class="number">&#x27;</span>v<span class="number">&#x27;</span>:</span><br><span class="line">                v = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">                s = atoi(optarg);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;E&#x27;</span>:</span><br><span class="line">                E = atoi(optarg);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">                b=atoi(optarg);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;t&#x27;</span>:</span><br><span class="line">                <span class="built_in">strcpy</span>(file, optarg);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;wrong argument\n&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(s&lt;=<span class="number">0</span> || E&lt;=<span class="number">0</span> || b&lt;=<span class="number">0</span> || file==<span class="literal">NULL</span>) <span class="comment">// 如果选项参数不合格就退出</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    S=<span class="number">1</span>&lt;&lt;s;   <span class="comment">//S=2^s</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;s<span class="number">-1</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        mask1=mask1&lt;&lt;<span class="number">1</span>;</span><br><span class="line">        mask1=mask1|<span class="number">0x1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;s+b<span class="number">-1</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        mask2=mask2&lt;&lt;<span class="number">1</span>;</span><br><span class="line">        mask2=mask2|<span class="number">0x1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    init_Cache(s,E,b);  <span class="comment">//初始化cache内存空间</span></span><br><span class="line">    trace_test();    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span> ;i&lt;S;i++)   <span class="comment">//释放空间</span></span><br><span class="line">        <span class="built_in">free</span>(cache[i]);</span><br><span class="line">    <span class="built_in">free</span>(cache);</span><br><span class="line"></span><br><span class="line">    printSummary(hits, misss, evictions);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/02/23/CacheLab/" data-id="cl0522zgg0000twugh3uy1dah" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2022/02/23/Docker%20%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/02/23/CacheLab/">(no title)</a>
          </li>
        
          <li>
            <a href="/2022/02/23/Docker%20%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/">(no title)</a>
          </li>
        
          <li>
            <a href="/2022/02/06/Lab3%20Buffer%20lab/">(no title)</a>
          </li>
        
          <li>
            <a href="/2022/01/22/bomblab/">bomblab</a>
          </li>
        
          <li>
            <a href="/2022/01/14/CSAPP-LAB1/">CSAPP LAB1</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>